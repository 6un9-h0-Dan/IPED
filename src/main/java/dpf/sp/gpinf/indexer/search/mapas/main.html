<html> 
    <head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<link type="text/css" rel="stylesheet" href="gmap.css" />
		<style type="text/css" media="screen">
		#map-container { height:800px;overflow:scroll; }
		.circle_class{
			border-radius: 50%;
		}
		.rect_class{
			border-radius: 0%;
		}
		body { margin:0px;padding:0px }
		</style>		

        <script type="text/javascript" src= "http://maps.google.com/maps/api/js?sensor=false&libraries=geometry"></script>
        <script type="text/javascript">
		{{load_geoxml3}}
		</script>
		<script type="text/javascript">
		{{load_geoxml3_ext}}
		</script>
		<script type="text/javascript">
		{{load_keydragzoom}}
		</script>
		<script type="text/javascript">
		{{load_extensions}}
		</script>
        <script>
    var map;
	var gxml;
	var proxy = "/cgi-bin/proxy.php?"
    function initialize() {
        var kmlUrl = '';
        var myOptions = {
            mapTypeId: google.maps.MapTypeId.HYBRID,
			zoom: 3,
			center: new google.maps.LatLng(0,0)
			}
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	 	gxml = new GeoXmlIped("gxml", map, kmlUrl, {
			sidebarid:"the_side_bar",
			publishdirectory:"",
			messagestyle:{opacity:1.0 ,backgroundColor:"#a0c0fE", borderWidth:"1px"},
			iwwidth:280
		});	 	
		gxml.processString('{{kml}}', 'Resultados'); 
		map.enableKeyDragSelect();
		
		document.getElementById('resultsinfo').innerHTML = gxml.overlayman.markers.length+' itens com coordenadas geográficas foram mapeados.'; 
		
	    map.addListener('dragend_rect', function(rect, proj) {
	    	var ms = gxml.selecionaRetangulo(rect, proj, selecionaMarcador);
	    	selecionaMarcadorBF(ms);
    	  });
	    map.addListener('dragend_circle', function(pInicio, pFim, proj) {
	    	var ms = gxml.selecionaCirculo(pInicio, pFim, proj, selecionaMarcador);
	    	selecionaMarcadorBF(ms);
    	  });
	    
	    var icone_marcador_selecionado = "{{icone_selecionado_base64}}"; 
	    var icone_marcador = "{{icone_base64}}"; 
	    var icone_marcador_selecionado_m = "{{icone_selecionado_m_base64}}";
	    
	    function selecionaMarcador(marcador){
	    	if(typeof(marcador.selecionado)==='undefined' || marcador.selecionado == 0){
				var bicon = new google.maps.MarkerImage(icone_marcador_selecionado,
						new google.maps.Size(32, 32), //size
						new google.maps.Point(0, 0), //origin
						new google.maps.Point(16, 16), //anchor
						new google.maps.Size(32, 32) //scaledSize
				);
				marcador.setIcon(bicon);
				marcador.selecionado = 1;
	    	}else{
				var bicon = new google.maps.MarkerImage(icone_marcador,
						new google.maps.Size(32, 32), //size
						new google.maps.Point(0, 0), //origin
						new google.maps.Point(16, 16), //anchor
						new google.maps.Size(32, 32) //scaledSize
				);
				marcador.setIcon(bicon);
				marcador.selecionado = 0;
	    	}
	    }
    }
        </script>
    </head>
    <body onload="initialize()">
       <table style="height:100%;width:100%"><tr><td width="*">
  <div id="map_canvas" style="width:100%;height:100%;"></div></td>
    <td width="50px">
   <div id="barra_lateral" style="height:100%;width:100%;">
   		<input type="button" name="teste" value="Marcar Selecionados"/>
   	 	<div id="resultsinfo"></div>
   	 	<div style="position:relative; top:20px;">Pressione [Ctrl] para seleção radial. 
		<br/>Pressione [Shift] para seleção retangular.</div>
		<div style="position:absolute; bottom:20px;" id="distancia_calc"></div>
   </div>
   </td></tr>
</table>
    </body>
    <div id="the_side_bar" style="position:fixed;float:right;height:100%;width:100%; visibility:hidden"></div>    
</html>